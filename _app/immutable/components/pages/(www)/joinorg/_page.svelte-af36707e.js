import{S as ce,i as ue,s as fe,M as _e,a as D,e as re,c as B,b as A,N as pe,f as R,t as j,h as f,I as ae,o as ge,k as b,q as S,l as h,m as $,r as U,E as u,u as be,X as he,B as d,w as Q,x as X,n as y,Y as le,y as K,J as P,Z as ie,_ as ve,z as W,K as $e}from"../../../../chunks/index-9cd25cf6.js";import{u as me}from"../../../../chunks/useForm-fa7d1a1f.js";import{c as de,p as Y}from"../../../../chunks/pocketbase-389f893c.js";import{H as ke,a as ye}from"../../../../chunks/HintGroup-b5a73d00.js";import{v as we,r as Ee}from"../../../../chunks/validators-08ded706.js";/* empty css                                         */import{g as F}from"../../../../chunks/navigation-05f958b5.js";function se(r){let t,n;return{c(){t=b("p"),n=S(r[1])},l(o){t=h(o,"P",{});var e=$(t);n=U(e,r[1]),e.forEach(f)},m(o,e){A(o,t,e),u(t,n)},p(o,e){e&2&&be(n,o[1])},d(o){o&&f(t)}}}function Ie(r){return{c:d,l:d,m:d,p:d,i:d,o:d,d}}function Ne(r){let t,n,o,e,l,a,i,O,L,_,V,k,q,s,p,I,m,C,g,N,T,w,G,H,J,Z;return k=new ke({props:{for:"invitecode",$$slots:{default:[Ae]},$$scope:{ctx:r}}}),{c(){t=b("h1"),n=S("Create an org"),o=D(),e=b("form"),l=b("div"),a=b("div"),i=b("label"),O=S("Invite key"),L=D(),_=b("input"),V=D(),Q(k.$$.fragment),q=D(),s=b("div"),p=b("button"),I=S("Sign up"),C=D(),g=b("button"),N=S("Nevermind, sign out"),T=D(),w=b("button"),G=S("Create an org instead"),this.h()},l(c){t=h(c,"H1",{class:!0});var v=$(t);n=U(v,"Create an org"),v.forEach(f),o=B(c),e=h(c,"FORM",{method:!0});var E=$(e);l=h(E,"DIV",{class:!0});var x=$(l);a=h(x,"DIV",{});var z=$(a);i=h(z,"LABEL",{for:!0});var ee=$(i);O=U(ee,"Invite key"),ee.forEach(f),L=B(z),_=h(z,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),V=B(z),X(k.$$.fragment,z),z.forEach(f),x.forEach(f),q=B(E),s=h(E,"DIV",{class:!0});var M=$(s);p=h(M,"BUTTON",{});var te=$(p);I=U(te,"Sign up"),te.forEach(f),C=B(M),g=h(M,"BUTTON",{class:!0});var oe=$(g);N=U(oe,"Nevermind, sign out"),oe.forEach(f),M.forEach(f),T=B(E),w=h(E,"BUTTON",{});var ne=$(w);G=U(ne,"Create an org instead"),ne.forEach(f),E.forEach(f),this.h()},h(){y(t,"class","page-name-header"),y(i,"for","invitecode"),y(_,"type","username"),y(_,"name","invitecode"),y(_,"id","invitecode"),y(_,"placeholder","dQw4w9WgXcQ"),y(l,"class","grid"),p.disabled=m=!r[2].valid,y(g,"class","secondary"),y(s,"class","grid"),y(e,"method","POST")},m(c,v){A(c,t,v),u(t,n),A(c,o,v),A(c,e,v),u(e,l),u(l,a),u(a,i),u(i,O),u(a,L),u(a,_),le(_,r[0]),u(a,V),K(k,a,null),u(e,q),u(e,s),u(s,p),u(p,I),u(s,C),u(s,g),u(g,N),u(e,T),u(e,w),u(w,G),H=!0,J||(Z=[P(_,"input",r[8]),ie(we.call(null,_,[Ee])),P(p,"click",r[4]),P(g,"click",r[6]),P(w,"click",r[5]),ie(r[3].call(null,e)),P(e,"submit",ve(r[7]))],J=!0)},p(c,v){v&1&&le(_,c[0]);const E={};v&8192&&(E.$$scope={dirty:v,ctx:c}),k.$set(E),(!H||v&4&&m!==(m=!c[2].valid))&&(p.disabled=m)},i(c){H||(R(k.$$.fragment,c),H=!0)},o(c){j(k.$$.fragment,c),H=!1},d(c){c&&f(t),c&&f(o),c&&f(e),W(k),J=!1,$e(Z)}}}function Te(r){let t;return{c(){t=S("This is a mandatory field")},l(n){t=U(n,"This is a mandatory field")},m(n,o){A(n,t,o)},d(n){n&&f(t)}}}function Ae(r){let t,n;return t=new ye({props:{on:"required",$$slots:{default:[Te]},$$scope:{ctx:r}}}),{c(){Q(t.$$.fragment)},l(o){X(t.$$.fragment,o)},m(o,e){K(t,o,e),n=!0},p(o,e){const l={};e&8192&&(l.$$scope={dirty:e,ctx:o}),t.$set(l)},i(o){n||(R(t.$$.fragment,o),n=!0)},o(o){j(t.$$.fragment,o),n=!1},d(o){W(t,o)}}}function Oe(r){return{c:d,l:d,m:d,p:d,i:d,o:d,d}}function Ce(r){let t,n,o,e=r[1]&&se(r),l={ctx:r,current:null,token:null,hasCatch:!1,pending:Oe,then:Ne,catch:Ie,value:12,blocks:[,,,]};return _e(de,l),{c(){e&&e.c(),t=D(),n=re(),l.block.c()},l(a){e&&e.l(a),t=B(a),n=re(),l.block.l(a)},m(a,i){e&&e.m(a,i),A(a,t,i),A(a,n,i),l.block.m(a,l.anchor=i),l.mount=()=>n.parentNode,l.anchor=n,o=!0},p(a,[i]){r=a,r[1]?e?e.p(r,i):(e=se(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null),pe(l,r,i)},i(a){o||(R(l.block),o=!0)},o(a){for(let i=0;i<3;i+=1){const O=l.blocks[i];j(O)}o=!1},d(a){e&&e.d(a),a&&f(t),a&&f(n),l.block.d(a),l.token=null,l=null}}}function De(r,t,n){let o,e;ae(r,de,s=>n(9,o=s));const l=me();ae(r,l,s=>n(2,e=s));let a,i;async function O(s){let p=["facilitator_code","observer_code","participant_code"],I=["facilitator","observer","participant"],m=0;for(const C of p)try{const g=await Y.collection("organization").getFullList(200,{filter:`${C}="${s}"`});if(Array.isArray(g)&&g.length==1){let N=g[0],T=I[m];return{org_name:N,role_name:T}}m++}finally{console.log("")}}async function L(){var s,p,I;try{let m=await O(a);(m.role_name==""||((s=m.org_name)==null?void 0:s.id)=="")&&n(1,i="INVALID CODE; TRY AGAIn");const C={role:m.role_name,org:(p=m.org_name)==null?void 0:p.id},g=await Y.collection("users").update(o.id,C);if(o.org!=""){const N=await Y.collection("organization").getOne(o.org,{expand:"members"});console.log(N.members);let T=[...N.members,o.id];console.log(T);const w={name:m.org_name.name,members:T};console.log(w);const G=await Y.collection("organization").update((I=m.org_name)==null?void 0:I.id,w);await F("/account")}else n(1,i="INVALID CODE; TRY AGAIN"),await F("/joinorg")}catch(m){n(1,i=m),console.log(m)}}async function _(){F("createorg")}async function V(){await Y.authStore.clear(),F("/")}ge(async()=>{o.org!=""&&F("/account")});function k(s){he.call(this,r,s)}function q(){a=this.value,n(0,a)}return[a,i,e,l,L,_,V,k,q]}class Be extends ce{constructor(t){super(),ue(this,t,De,Ce,fe,{})}}function Se(r){let t,n,o;return n=new Be({}),{c(){t=b("body"),Q(n.$$.fragment)},l(e){t=h(e,"BODY",{});var l=$(t);X(n.$$.fragment,l),l.forEach(f)},m(e,l){A(e,t,l),K(n,t,null),o=!0},p:d,i(e){o||(R(n.$$.fragment,e),o=!0)},o(e){j(n.$$.fragment,e),o=!1},d(e){e&&f(t),W(n)}}}function Ue(r){return me(),[]}class Fe extends ce{constructor(t){super(),ue(this,t,Ue,Se,fe,{})}}export{Fe as default};
