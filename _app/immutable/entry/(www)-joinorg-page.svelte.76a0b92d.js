import{S as ce,i as ue,s as fe,N as _e,a as D,e as re,c as B,b as A,O as pe,g as j,d as J,h as f,J as ae,o as ge,k as b,r as L,l as h,m as $,u as S,F as u,v as be,X as he,n as m,z as Q,A as X,p as y,Y as le,B as K,K as P,Z as ie,_ as ve,C as W,L as $e}from"../chunks/index.7f1a9c88.js";import{u as de}from"../chunks/useForm.256e94d5.js";import{c as me,p as Y}from"../chunks/pocketbase.2fde5c2d.js";import{H as ke,a as ye}from"../chunks/HintGroup.0d943f9c.js";import{v as we,r as Ee}from"../chunks/validators.9266e364.js";/* empty css                                */import{g as q}from"../chunks/navigation.e42409cb.js";function se(r){let t,n;return{c(){t=b("p"),n=L(r[1])},l(o){t=h(o,"P",{});var e=$(t);n=S(e,r[1]),e.forEach(f)},m(o,e){A(o,t,e),u(t,n)},p(o,e){e&2&&be(n,o[1])},d(o){o&&f(t)}}}function Ie(r){return{c:m,l:m,m,p:m,i:m,o:m,d:m}}function Ne(r){let t,n,o,e,l,a,i,O,z,_,V,k,F,s,p,I,d,C,g,N,T,w,G,H,M,Z;return k=new ke({props:{for:"invitecode",$$slots:{default:[Ae]},$$scope:{ctx:r}}}),{c(){t=b("h1"),n=L("Create an org"),o=D(),e=b("form"),l=b("div"),a=b("div"),i=b("label"),O=L("Invite key"),z=D(),_=b("input"),V=D(),Q(k.$$.fragment),F=D(),s=b("div"),p=b("button"),I=L("Sign up"),C=D(),g=b("button"),N=L("Nevermind, sign out"),T=D(),w=b("button"),G=L("Create an org instead"),this.h()},l(c){t=h(c,"H1",{class:!0});var v=$(t);n=S(v,"Create an org"),v.forEach(f),o=B(c),e=h(c,"FORM",{method:!0});var E=$(e);l=h(E,"DIV",{class:!0});var x=$(l);a=h(x,"DIV",{});var U=$(a);i=h(U,"LABEL",{for:!0});var ee=$(i);O=S(ee,"Invite key"),ee.forEach(f),z=B(U),_=h(U,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),V=B(U),X(k.$$.fragment,U),U.forEach(f),x.forEach(f),F=B(E),s=h(E,"DIV",{class:!0});var R=$(s);p=h(R,"BUTTON",{});var te=$(p);I=S(te,"Sign up"),te.forEach(f),C=B(R),g=h(R,"BUTTON",{class:!0});var oe=$(g);N=S(oe,"Nevermind, sign out"),oe.forEach(f),R.forEach(f),T=B(E),w=h(E,"BUTTON",{});var ne=$(w);G=S(ne,"Create an org instead"),ne.forEach(f),E.forEach(f),this.h()},h(){y(t,"class","page-name-header"),y(i,"for","invitecode"),y(_,"type","username"),y(_,"name","invitecode"),y(_,"id","invitecode"),y(_,"placeholder","dQw4w9WgXcQ"),y(l,"class","grid"),p.disabled=d=!r[2].valid,y(g,"class","secondary"),y(s,"class","grid"),y(e,"method","POST")},m(c,v){A(c,t,v),u(t,n),A(c,o,v),A(c,e,v),u(e,l),u(l,a),u(a,i),u(i,O),u(a,z),u(a,_),le(_,r[0]),u(a,V),K(k,a,null),u(e,F),u(e,s),u(s,p),u(p,I),u(s,C),u(s,g),u(g,N),u(e,T),u(e,w),u(w,G),H=!0,M||(Z=[P(_,"input",r[8]),ie(we.call(null,_,[Ee])),P(p,"click",r[4]),P(g,"click",r[6]),P(w,"click",r[5]),ie(r[3].call(null,e)),P(e,"submit",ve(r[7]))],M=!0)},p(c,v){v&1&&le(_,c[0]);const E={};v&8192&&(E.$$scope={dirty:v,ctx:c}),k.$set(E),(!H||v&4&&d!==(d=!c[2].valid))&&(p.disabled=d)},i(c){H||(j(k.$$.fragment,c),H=!0)},o(c){J(k.$$.fragment,c),H=!1},d(c){c&&f(t),c&&f(o),c&&f(e),W(k),M=!1,$e(Z)}}}function Te(r){let t;return{c(){t=L("This is a mandatory field")},l(n){t=S(n,"This is a mandatory field")},m(n,o){A(n,t,o)},d(n){n&&f(t)}}}function Ae(r){let t,n;return t=new ye({props:{on:"required",$$slots:{default:[Te]},$$scope:{ctx:r}}}),{c(){Q(t.$$.fragment)},l(o){X(t.$$.fragment,o)},m(o,e){K(t,o,e),n=!0},p(o,e){const l={};e&8192&&(l.$$scope={dirty:e,ctx:o}),t.$set(l)},i(o){n||(j(t.$$.fragment,o),n=!0)},o(o){J(t.$$.fragment,o),n=!1},d(o){W(t,o)}}}function Oe(r){return{c:m,l:m,m,p:m,i:m,o:m,d:m}}function Ce(r){let t,n,o,e=r[1]&&se(r),l={ctx:r,current:null,token:null,hasCatch:!1,pending:Oe,then:Ne,catch:Ie,value:12,blocks:[,,,]};return _e(me,l),{c(){e&&e.c(),t=D(),n=re(),l.block.c()},l(a){e&&e.l(a),t=B(a),n=re(),l.block.l(a)},m(a,i){e&&e.m(a,i),A(a,t,i),A(a,n,i),l.block.m(a,l.anchor=i),l.mount=()=>n.parentNode,l.anchor=n,o=!0},p(a,[i]){r=a,r[1]?e?e.p(r,i):(e=se(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null),pe(l,r,i)},i(a){o||(j(l.block),o=!0)},o(a){for(let i=0;i<3;i+=1){const O=l.blocks[i];J(O)}o=!1},d(a){e&&e.d(a),a&&f(t),a&&f(n),l.block.d(a),l.token=null,l=null}}}function De(r,t,n){let o,e;ae(r,me,s=>n(9,o=s));const l=de();ae(r,l,s=>n(2,e=s));let a,i;async function O(s){let p=["facilitator_code","observer_code","participant_code"],I=["facilitator","observer","participant"],d=0;for(const C of p)try{const g=await Y.collection("organization").getFullList(200,{filter:`${C}="${s}"`});if(Array.isArray(g)&&g.length==1){let N=g[0],T=I[d];return{org_name:N,role_name:T}}d++}finally{console.log("")}}async function z(){var s,p,I;try{let d=await O(a);(d.role_name==""||((s=d.org_name)==null?void 0:s.id)=="")&&n(1,i="INVALID CODE; TRY AGAIn");const C={role:d.role_name,org:(p=d.org_name)==null?void 0:p.id},g=await Y.collection("users").update(o.id,C);if(o.org!=""){const N=await Y.collection("organization").getOne(o.org,{expand:"members"});console.log(N.members);let T=[...N.members,o.id];console.log(T);const w={name:d.org_name.name,members:T};console.log(w);const G=await Y.collection("organization").update((I=d.org_name)==null?void 0:I.id,w);await q("/account")}else n(1,i="INVALID CODE; TRY AGAIN"),await q("/joinorg")}catch(d){n(1,i=d),console.log(d)}}async function _(){q("createorg")}async function V(){await Y.authStore.clear(),q("/")}ge(async()=>{o.org!=""&&q("/account")});function k(s){he.call(this,r,s)}function F(){a=this.value,n(0,a)}return[a,i,e,l,z,_,V,k,F]}class Be extends ce{constructor(t){super(),ue(this,t,De,Ce,fe,{})}}function Le(r){let t,n,o;return n=new Be({}),{c(){t=b("body"),Q(n.$$.fragment)},l(e){t=h(e,"BODY",{});var l=$(t);X(n.$$.fragment,l),l.forEach(f)},m(e,l){A(e,t,l),K(n,t,null),o=!0},p:m,i(e){o||(j(n.$$.fragment,e),o=!0)},o(e){J(n.$$.fragment,e),o=!1},d(e){e&&f(t),W(n)}}}function Se(r){return de(),[]}class qe extends ce{constructor(t){super(),ue(this,t,Se,Le,fe,{})}}export{qe as default};
