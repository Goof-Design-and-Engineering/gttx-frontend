import{S as ue,i as ie,s as ce,D as pe,e as V,b as k,H as de,n as w,h as n,L as oe,o as fe,R as me,k as _,r as B,a as H,l as h,m as S,u as O,c as I,q as _e,p,G as c,V as R,M as A,W as G,Y as he,v as be,N as we,z as ve,A as Pe,B as ke,g as ye,d as ge,C as Se}from"../chunks/index.d8729f0b.js";import{u as Ee}from"../chunks/useForm.f7d2ec9d.js";import{v as X,r as Z}from"../chunks/validators.6e79bf68.js";import{c as ee,p as $}from"../chunks/pocketbase.f160ef4f.js";import{g as x}from"../chunks/navigation.d9a36482.js";function Ne(r){return{c:w,l:w,m:w,p:w,d:w}}function Be(r){let a,e=r[4]&&ne(r);return{c(){e&&e.c(),a=V()},l(t){e&&e.l(t),a=V()},m(t,o){e&&e.m(t,o),k(t,a,o)},p(t,o){t[4]?e?e.p(t,o):(e=ne(t),e.c(),e.m(a.parentNode,a)):e&&(e.d(1),e=null)},d(t){e&&e.d(t),t&&n(a)}}}function ne(r){let a,e,t,o=r[4].username+"",d,l,i,E,T,y,v,Y,f,q,m,b,P,D,L,M,N,U,W,j,g,J,z,K,te;return{c(){a=_("hgroup"),e=_("h1"),t=B("Password Change for "),d=B(o),l=H(),i=_("h2"),E=B("Be careful! Password changes are permanent!"),T=H(),y=_("form"),v=_("label"),Y=B(`Old Password
				`),f=_("input"),q=B(`

				New Password
				`),m=_("input"),b=B(`

				New Password (...Again)
				`),P=_("input"),D=H(),L=_("br"),M=H(),N=_("div"),U=_("button"),W=B("Back to Settings"),j=H(),g=_("button"),J=B("Submit"),this.h()},l(s){a=h(s,"HGROUP",{});var u=S(a);e=h(u,"H1",{style:!0});var Q=S(e);t=O(Q,"Password Change for "),d=O(Q,o),Q.forEach(n),l=I(u),i=h(u,"H2",{});var ae=S(i);E=O(ae,"Be careful! Password changes are permanent!"),ae.forEach(n),u.forEach(n),T=I(s),y=h(s,"FORM",{method:!0});var se=S(y);v=h(se,"LABEL",{});var C=S(v);Y=O(C,`Old Password
				`),f=h(C,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),q=O(C,`

				New Password
				`),m=h(C,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),b=O(C,`

				New Password (...Again)
				`),P=h(C,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),C.forEach(n),se.forEach(n),D=I(s),L=h(s,"BR",{}),M=I(s),N=h(s,"DIV",{class:!0});var F=S(N);U=h(F,"BUTTON",{class:!0});var re=S(U);W=O(re,"Back to Settings"),re.forEach(n),j=I(F),g=h(F,"BUTTON",{"aria-busy":!0});var le=S(g);J=O(le,"Submit"),le.forEach(n),F.forEach(n),this.h()},h(){_e(e,"font-size","40px"),p(f,"type","password"),p(f,"name","oldpassword"),p(f,"id","password"),p(f,"placeholder","hunter2"),p(m,"type","password"),p(m,"name","oldpassword"),p(m,"id","password"),p(m,"placeholder","SuperSecure69"),p(P,"type","password"),p(P,"name","new_password_again"),p(P,"id","password"),p(P,"placeholder","SuperSecure69"),p(y,"method","POST"),p(U,"class","secondary"),g.disabled=z=!r[5].valid,p(g,"aria-busy",r[3]),p(N,"class","grid")},m(s,u){k(s,a,u),c(a,e),c(e,t),c(e,d),c(a,l),c(a,i),c(i,E),k(s,T,u),k(s,y,u),c(y,v),c(v,Y),c(v,f),R(f,r[0]),c(v,q),c(v,m),R(m,r[1]),c(v,b),c(v,P),R(P,r[2]),k(s,D,u),k(s,L,u),k(s,M,u),k(s,N,u),c(N,U),c(U,W),c(N,j),c(N,g),c(g,J),K||(te=[A(f,"input",r[10]),G(X.call(null,f,[Z])),A(m,"input",r[11]),G(X.call(null,m,[Z])),A(P,"input",r[12]),G(X.call(null,P,[Z])),G(r[6].call(null,y)),A(y,"submit",he(r[9])),A(U,"click",r[8]),A(g,"click",r[7])],K=!0)},p(s,u){u&16&&o!==(o=s[4].username+"")&&be(d,o),u&1&&f.value!==s[0]&&R(f,s[0]),u&2&&m.value!==s[1]&&R(m,s[1]),u&4&&P.value!==s[2]&&R(P,s[2]),u&32&&z!==(z=!s[5].valid)&&(g.disabled=z),u&8&&p(g,"aria-busy",s[3])},d(s){s&&n(a),s&&n(T),s&&n(y),s&&n(D),s&&n(L),s&&n(M),s&&n(N),K=!1,we(te)}}}function Oe(r){return{c:w,l:w,m:w,p:w,d:w}}function Te(r){let a,e={ctx:r,current:null,token:null,hasCatch:!1,pending:Oe,then:Be,catch:Ne,value:13};return pe(ee,e),{c(){a=V(),e.block.c()},l(t){a=V(),e.block.l(t)},m(t,o){k(t,a,o),e.block.m(t,e.anchor=o),e.mount=()=>a.parentNode,e.anchor=a},p(t,[o]){r=t,de(e,r,o)},i:w,o:w,d(t){t&&n(a),e.block.d(t),e.token=null,e=null}}}function Ue(r,a,e){let t,o;oe(r,ee,b=>e(4,t=b));var d="",l="",i="";let E=!1;const T=Ee();oe(r,T,b=>e(5,o=b));async function y(){console.log(ee);try{if(e(3,E=!0),await $.collection("users").authWithPassword(t.username,d),l==i&&l!=""){console.log("Passwords matched, clearing auth and updating password!");try{await $.collection("users").update(t.id,{oldPassword:d,password:l,passwordConfirm:i}),$.authStore.clear(),x("/login")}catch(b){e(3,E=!1),console.log(b),alert("Something went wrong, please try again.")}}else e(3,E=!1),alert("Your passwords do not match!")}catch(b){e(3,E=!1),console.log(b),alert("Your old password was not correct!")}}async function v(){x("/account")}fe(()=>{t||x("/login")});function Y(b){me.call(this,r,b)}function f(){d=this.value,e(0,d)}function q(){l=this.value,e(1,l)}function m(){i=this.value,e(2,i)}return[d,l,i,E,t,o,T,y,v,Y,f,q,m]}class Ce extends ue{constructor(a){super(),ie(this,a,Ue,Te,ce,{})}}function Re(r){let a,e,t,o,d;return e=new Ce({}),{c(){a=_("body"),ve(e.$$.fragment),t=H(),o=_("pre")},l(l){a=h(l,"BODY",{});var i=S(a);Pe(e.$$.fragment,i),i.forEach(n),t=I(l),o=h(l,"PRE",{}),S(o).forEach(n)},m(l,i){k(l,a,i),ke(e,a,null),k(l,t,i),k(l,o,i),d=!0},p:w,i(l){d||(ye(e.$$.fragment,l),d=!0)},o(l){ge(e.$$.fragment,l),d=!1},d(l){l&&n(a),Se(e),l&&n(t),l&&n(o)}}}class De extends ue{constructor(a){super(),ie(this,a,null,Re,ce,{})}}export{De as default};
