import{S as pe,i as be,s as he,D as ve,e as ue,b as R,H as ye,g as W,d as X,h as i,L as fe,o as ke,R as $e,n as _,k as c,r as A,a as C,z as ee,l as u,m as E,u as L,c as I,A as te,p as v,G as s,W as de,B as re,M as F,X as me,Z as Ee,C as ne,N as we,q as x}from"../chunks/index.4fc2f4c3.js";import{c as ge,p as M}from"../chunks/pocketbase.cc5ca80f.js";import{H as Te,a as Ne}from"../chunks/HintGroup.74a3b5b1.js";import{u as Be}from"../chunks/useForm.24789db4.js";import{v as Oe,r as ze}from"../chunks/validators.c512e31b.js";import{g as V}from"../chunks/navigation.3dc8513e.js";function Ce(a){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function Ie(a){let r,n,t,e,o,f,y,N,P,h,S,w,Y,k,p,T,B,d,U,O,D,$,z,j,Z,H,K,J,Q,oe;w=new Te({props:{for:"invitecode",$$slots:{default:[Ue]},$$scope:{ctx:a}}});let m=a[1]&&_e(a);return{c(){r=c("h1"),n=A("Join an org"),t=C(),e=c("form"),o=c("div"),f=c("div"),y=c("label"),N=A("Invite key"),P=C(),h=c("input"),S=C(),ee(w.$$.fragment),Y=C(),k=c("button"),p=A("Join the organization!"),B=C(),m&&m.c(),d=C(),U=c("hr"),O=c("br"),D=C(),$=c("div"),z=c("button"),j=A("Create an org instead"),Z=C(),H=c("button"),K=A("Nevermind, sign out"),this.h()},l(l){r=u(l,"H1",{class:!0});var g=E(r);n=L(g,"Join an org"),g.forEach(i),t=I(l),e=u(l,"FORM",{method:!0});var b=E(e);o=u(b,"DIV",{class:!0});var ae=E(o);f=u(ae,"DIV",{});var q=E(f);y=u(q,"LABEL",{for:!0});var le=E(y);N=L(le,"Invite key"),le.forEach(i),P=I(q),h=u(q,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),S=I(q),te(w.$$.fragment,q),q.forEach(i),ae.forEach(i),Y=I(b),k=u(b,"BUTTON",{"aria-busy":!0});var se=E(k);p=L(se,"Join the organization!"),se.forEach(i),B=I(b),m&&m.l(b),d=I(b),U=u(b,"HR",{}),O=u(b,"BR",{}),D=I(b),$=u(b,"DIV",{class:!0});var G=E($);z=u(G,"BUTTON",{});var ie=E(z);j=L(ie,"Create an org instead"),ie.forEach(i),Z=I(G),H=u(G,"BUTTON",{class:!0});var ce=E(H);K=L(ce,"Nevermind, sign out"),ce.forEach(i),G.forEach(i),b.forEach(i),this.h()},h(){v(r,"class","page-name-header"),v(y,"for","invitecode"),v(h,"type","username"),v(h,"name","invitecode"),v(h,"id","invitecode"),v(h,"placeholder","Your code (should be a mix of letters and numbers)"),v(o,"class","grid"),k.disabled=T=!a[3].valid||a[2],v(k,"aria-busy",a[2]),v(H,"class","contrast"),v($,"class","grid"),v(e,"method","POST")},m(l,g){R(l,r,g),s(r,n),R(l,t,g),R(l,e,g),s(e,o),s(o,f),s(f,y),s(y,N),s(f,P),s(f,h),de(h,a[0]),s(f,S),re(w,f,null),s(e,Y),s(e,k),s(k,p),s(e,B),m&&m.m(e,null),s(e,d),s(e,U),s(e,O),s(e,D),s(e,$),s($,z),s(z,j),s($,Z),s($,H),s(H,K),J=!0,Q||(oe=[F(h,"input",a[9]),me(Oe.call(null,h,[ze])),F(k,"click",a[5]),F(z,"click",a[6]),F(H,"click",a[7]),me(a[4].call(null,e)),F(e,"submit",Ee(a[8]))],Q=!0)},p(l,g){g&1&&de(h,l[0]);const b={};g&8192&&(b.$$scope={dirty:g,ctx:l}),w.$set(b),(!J||g&12&&T!==(T=!l[3].valid||l[2]))&&(k.disabled=T),(!J||g&4)&&v(k,"aria-busy",l[2]),l[1]?m?m.p(l,g):(m=_e(l),m.c(),m.m(e,d)):m&&(m.d(1),m=null)},i(l){J||(W(w.$$.fragment,l),J=!0)},o(l){X(w.$$.fragment,l),J=!1},d(l){l&&i(r),l&&i(t),l&&i(e),ne(w),m&&m.d(),Q=!1,we(oe)}}}function Re(a){let r,n,t;return{c(){r=c("center"),n=A("This is a mandatory field"),t=c("br")},l(e){r=u(e,"CENTER",{});var o=E(r);n=L(o,"This is a mandatory field"),o.forEach(i),t=u(e,"BR",{})},m(e,o){R(e,r,o),s(r,n),R(e,t,o)},p:_,d(e){e&&i(r),e&&i(t)}}}function Ue(a){let r,n;return r=new Ne({props:{on:"required",$$slots:{default:[Re]},$$scope:{ctx:a}}}),{c(){ee(r.$$.fragment)},l(t){te(r.$$.fragment,t)},m(t,e){re(r,t,e),n=!0},p(t,e){const o={};e&8192&&(o.$$scope={dirty:e,ctx:t}),r.$set(o)},i(t){n||(W(r.$$.fragment,t),n=!0)},o(t){X(r.$$.fragment,t),n=!1},d(t){ne(r,t)}}}function _e(a){let r,n;return{c(){r=c("center"),n=c("input"),this.h()},l(t){r=u(t,"CENTER",{});var e=E(r);n=u(e,"INPUT",{style:!0,type:!0}),e.forEach(i),this.h()},h(){x(n,"border","2px solid red"),x(n,"border-radius","5px"),x(n,"text-align","center"),v(n,"type","text"),n.value=a[1],n.readOnly=!0},m(t,e){R(t,r,e),s(r,n)},p(t,e){e&2&&n.value!==t[1]&&(n.value=t[1])},d(t){t&&i(r)}}}function He(a){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function De(a){let r,n,t={ctx:a,current:null,token:null,hasCatch:!1,pending:He,then:Ie,catch:Ce,value:12,blocks:[,,,]};return ve(ge,t),{c(){r=ue(),t.block.c()},l(e){r=ue(),t.block.l(e)},m(e,o){R(e,r,o),t.block.m(e,t.anchor=o),t.mount=()=>r.parentNode,t.anchor=r,n=!0},p(e,[o]){a=e,ye(t,a,o)},i(e){n||(W(t.block),n=!0)},o(e){for(let o=0;o<3;o+=1){const f=t.blocks[o];X(f)}n=!1},d(e){e&&i(r),t.block.d(e),t.token=null,t=null}}}function Je(a,r,n){let t,e;fe(a,ge,p=>n(10,t=p));const o=Be();fe(a,o,p=>n(3,e=p));let f,y,N=!1;async function P(p){let T=["observer_code","participant_code"],B=["observer","participant"],d=0;for(const U of T)try{const O=await M.collection("organization").getFullList(200,{filter:`${U}="${p}"`});if(Array.isArray(O)&&O.length==1){let D=O[0],$=B[d];return{org_name:D,role_name:$}}d++}finally{}}async function h(){var p,T,B;n(1,y="");try{n(2,N=!0);let d=await P(f);(d.role_name==""||((p=d.org_name)==null?void 0:p.id)=="")&&n(1,y="Your code seems to be invalid; try again!");const U={role:d.role_name,org:(T=d.org_name)==null?void 0:T.id},O=await M.collection("users").update(t.id,U);if(t.org!=""){let $=[...(await M.collection("organization").getOne(t.org,{expand:"members"})).members,t.id];const z={name:d.org_name.name,members:$},j=await M.collection("organization").update((B=d.org_name)==null?void 0:B.id,z);await V("/dashboard")}else n(1,y="Your code seems to be invlid; try again!"),await V("/joinorg")}catch(d){n(2,N=!1),n(1,y=d)}n(2,N=!1)}async function S(){V("createorg")}async function w(){await M.authStore.clear(),V("/")}ke(async()=>{t.org!=""&&V("/dashboard")});function Y(p){$e.call(this,a,p)}function k(){f=this.value,n(0,f)}return[f,y,N,e,o,h,S,w,Y,k]}class qe extends pe{constructor(r){super(),be(this,r,Je,De,he,{})}}function Ae(a){let r,n,t;return n=new qe({}),{c(){r=c("body"),ee(n.$$.fragment)},l(e){r=u(e,"BODY",{});var o=E(r);te(n.$$.fragment,o),o.forEach(i)},m(e,o){R(e,r,o),re(n,r,null),t=!0},p:_,i(e){t||(W(n.$$.fragment,e),t=!0)},o(e){X(n.$$.fragment,e),t=!1},d(e){e&&i(r),ne(n)}}}class Ve extends pe{constructor(r){super(),be(this,r,null,Ae,he,{})}}export{Ve as default};
