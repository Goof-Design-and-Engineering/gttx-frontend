import{S as ce,i as ue,s as fe,D as me,a as U,e as re,c as z,b as B,H as _e,g as j,d as G,h as f,L as ae,o as pe,k as b,r as C,l as h,m as $,u as D,G as u,v as ge,Y as be,n as m,z as K,A as Q,p as y,O as le,B as W,M as q,a4 as ie,a5 as he,C as X,N as ve}from"../chunks/index.b95161bf.js";import{c as de,p as F}from"../chunks/pocketbase.c09fd52b.js";import{H as $e,a as ke}from"../chunks/HintGroup.a676afc4.js";import{u as ye,v as we,r as Ee}from"../chunks/validators.c220a831.js";import{g as J}from"../chunks/navigation.7a5a56af.js";function se(r){let t,n;return{c(){t=b("p"),n=C(r[1])},l(o){t=h(o,"P",{});var e=$(t);n=D(e,r[1]),e.forEach(f)},m(o,e){B(o,t,e),u(t,n)},p(o,e){e&2&&ge(n,o[1])},d(o){o&&f(t)}}}function Te(r){return{c:m,l:m,m,p:m,i:m,o:m,d:m}}function Ne(r){let t,n,o,e,l,a,i,I,Y,_,A,k,L,s,p,T,d,S,g,N,O,w,M,P,R,Z;return k=new $e({props:{for:"invitecode",$$slots:{default:[Be]},$$scope:{ctx:r}}}),{c(){t=b("h1"),n=C("Join an org"),o=U(),e=b("form"),l=b("div"),a=b("div"),i=b("label"),I=C("Invite key"),Y=U(),_=b("input"),A=U(),K(k.$$.fragment),L=U(),s=b("div"),p=b("button"),T=C("Sign up"),S=U(),g=b("button"),N=C("Nevermind, sign out"),O=U(),w=b("button"),M=C("Create an org instead"),this.h()},l(c){t=h(c,"H1",{class:!0});var v=$(t);n=D(v,"Join an org"),v.forEach(f),o=z(c),e=h(c,"FORM",{method:!0});var E=$(e);l=h(E,"DIV",{class:!0});var x=$(l);a=h(x,"DIV",{});var H=$(a);i=h(H,"LABEL",{for:!0});var ee=$(i);I=D(ee,"Invite key"),ee.forEach(f),Y=z(H),_=h(H,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),A=z(H),Q(k.$$.fragment,H),H.forEach(f),x.forEach(f),L=z(E),s=h(E,"DIV",{class:!0});var V=$(s);p=h(V,"BUTTON",{});var te=$(p);T=D(te,"Sign up"),te.forEach(f),S=z(V),g=h(V,"BUTTON",{class:!0});var oe=$(g);N=D(oe,"Nevermind, sign out"),oe.forEach(f),V.forEach(f),O=z(E),w=h(E,"BUTTON",{});var ne=$(w);M=D(ne,"Create an org instead"),ne.forEach(f),E.forEach(f),this.h()},h(){y(t,"class","page-name-header"),y(i,"for","invitecode"),y(_,"type","username"),y(_,"name","invitecode"),y(_,"id","invitecode"),y(_,"placeholder","Your code (should be a mix of letters and numbers)"),y(l,"class","grid"),p.disabled=d=!r[2].valid,y(g,"class","secondary"),y(s,"class","grid"),y(e,"method","POST")},m(c,v){B(c,t,v),u(t,n),B(c,o,v),B(c,e,v),u(e,l),u(l,a),u(a,i),u(i,I),u(a,Y),u(a,_),le(_,r[0]),u(a,A),W(k,a,null),u(e,L),u(e,s),u(s,p),u(p,T),u(s,S),u(s,g),u(g,N),u(e,O),u(e,w),u(w,M),P=!0,R||(Z=[q(_,"input",r[8]),ie(we.call(null,_,[Ee])),q(p,"click",r[4]),q(g,"click",r[6]),q(w,"click",r[5]),ie(r[3].call(null,e)),q(e,"submit",he(r[7]))],R=!0)},p(c,v){v&1&&le(_,c[0]);const E={};v&4096&&(E.$$scope={dirty:v,ctx:c}),k.$set(E),(!P||v&4&&d!==(d=!c[2].valid))&&(p.disabled=d)},i(c){P||(j(k.$$.fragment,c),P=!0)},o(c){G(k.$$.fragment,c),P=!1},d(c){c&&f(t),c&&f(o),c&&f(e),X(k),R=!1,ve(Z)}}}function Oe(r){let t;return{c(){t=C("This is a mandatory field")},l(n){t=D(n,"This is a mandatory field")},m(n,o){B(n,t,o)},d(n){n&&f(t)}}}function Be(r){let t,n;return t=new ke({props:{on:"required",$$slots:{default:[Oe]},$$scope:{ctx:r}}}),{c(){K(t.$$.fragment)},l(o){Q(t.$$.fragment,o)},m(o,e){W(t,o,e),n=!0},p(o,e){const l={};e&4096&&(l.$$scope={dirty:e,ctx:o}),t.$set(l)},i(o){n||(j(t.$$.fragment,o),n=!0)},o(o){G(t.$$.fragment,o),n=!1},d(o){X(t,o)}}}function Ie(r){return{c:m,l:m,m,p:m,i:m,o:m,d:m}}function Se(r){let t,n,o,e=r[1]&&se(r),l={ctx:r,current:null,token:null,hasCatch:!1,pending:Ie,then:Ne,catch:Te,value:11,blocks:[,,,]};return me(de,l),{c(){e&&e.c(),t=U(),n=re(),l.block.c()},l(a){e&&e.l(a),t=z(a),n=re(),l.block.l(a)},m(a,i){e&&e.m(a,i),B(a,t,i),B(a,n,i),l.block.m(a,l.anchor=i),l.mount=()=>n.parentNode,l.anchor=n,o=!0},p(a,[i]){r=a,r[1]?e?e.p(r,i):(e=se(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null),_e(l,r,i)},i(a){o||(j(l.block),o=!0)},o(a){for(let i=0;i<3;i+=1){const I=l.blocks[i];G(I)}o=!1},d(a){e&&e.d(a),a&&f(t),a&&f(n),l.block.d(a),l.token=null,l=null}}}function Ue(r,t,n){let o,e;ae(r,de,s=>n(9,o=s));const l=ye();ae(r,l,s=>n(2,e=s));let a,i;async function I(s){let p=["facilitator_code","observer_code","participant_code"],T=["facilitator","observer","participant"],d=0;for(const S of p)try{const g=await F.collection("organization").getFullList(200,{filter:`${S}="${s}"`});if(Array.isArray(g)&&g.length==1){let N=g[0],O=T[d];return{org_name:N,role_name:O}}d++}finally{console.log("")}}async function Y(){var s,p,T;try{let d=await I(a);(d.role_name==""||((s=d.org_name)==null?void 0:s.id)=="")&&n(1,i="Your code seems to be invlid; try again!");const S={role:d.role_name,org:(p=d.org_name)==null?void 0:p.id},g=await F.collection("users").update(o.id,S);if(o.org!=""){const N=await F.collection("organization").getOne(o.org,{expand:"members"});console.log(N.members);let O=[...N.members,o.id];console.log(O);const w={name:d.org_name.name,members:O};console.log(w);const M=await F.collection("organization").update((T=d.org_name)==null?void 0:T.id,w);await J("/dashboard")}else n(1,i="Your code seems to be invlid; try again!"),await J("/joinorg")}catch(d){n(1,i=d),console.log(d)}}async function _(){J("createorg")}async function A(){await F.authStore.clear(),J("/")}pe(async()=>{o.org!=""&&J("/dashboard")});function k(s){be.call(this,r,s)}function L(){a=this.value,n(0,a)}return[a,i,e,l,Y,_,A,k,L]}class ze extends ce{constructor(t){super(),ue(this,t,Ue,Se,fe,{})}}function Ce(r){let t,n,o;return n=new ze({}),{c(){t=b("body"),K(n.$$.fragment)},l(e){t=h(e,"BODY",{});var l=$(t);Q(n.$$.fragment,l),l.forEach(f)},m(e,l){B(e,t,l),W(n,t,null),o=!0},p:m,i(e){o||(j(n.$$.fragment,e),o=!0)},o(e){G(n.$$.fragment,e),o=!1},d(e){e&&f(t),X(n)}}}class Pe extends ce{constructor(t){super(),ue(this,t,null,Ce,fe,{})}}export{Pe as default};
