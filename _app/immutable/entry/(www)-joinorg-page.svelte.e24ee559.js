import{S as de,i as me,s as _e,D as be,a as C,e as se,c as H,b as B,H as ge,g as G,d as W,h as u,L as ie,o as he,k as d,r as U,l as m,m as k,u as D,G as i,v as ve,R as $e,n as _,z as X,A as Z,p as y,V as ce,B as x,M as V,W as ue,Y as ye,C as ee,N as ke}from"../chunks/index.d8729f0b.js";import{c as pe,p as q}from"../chunks/pocketbase.f160ef4f.js";import{H as Ee,a as we}from"../chunks/HintGroup.6e42d805.js";import{u as Te}from"../chunks/useForm.f7d2ec9d.js";import{v as Ne,r as Be}from"../chunks/validators.6e79bf68.js";import{g as F}from"../chunks/navigation.40f10652.js";function fe(a){let t,r;return{c(){t=d("p"),r=U(a[1])},l(o){t=m(o,"P",{});var e=k(t);r=D(e,a[1]),e.forEach(u)},m(o,e){B(o,t,e),i(t,r)},p(o,e){e&2&&ve(r,o[1])},d(o){o&&u(t)}}}function ze(a){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function Oe(a){let t,r,o,e,n,l,s,w,L,b,P,T,S,h,p,N,z,f,I,O,g,E,J,M,R,K,Y,Q,te;return T=new Ee({props:{for:"invitecode",$$slots:{default:[He]},$$scope:{ctx:a}}}),{c(){t=d("h1"),r=U("Join an org"),o=C(),e=d("form"),n=d("div"),l=d("div"),s=d("label"),w=U("Invite key"),L=C(),b=d("input"),P=C(),X(T.$$.fragment),S=C(),h=d("button"),p=U("Join the organization!"),z=C(),f=d("hr"),I=d("br"),O=C(),g=d("div"),E=d("button"),J=U("Create an org instead"),M=C(),R=d("button"),K=U("Nevermind, sign out"),this.h()},l(c){t=m(c,"H1",{class:!0});var v=k(t);r=D(v,"Join an org"),v.forEach(u),o=H(c),e=m(c,"FORM",{method:!0});var $=k(e);n=m($,"DIV",{class:!0});var oe=k(n);l=m(oe,"DIV",{});var A=k(l);s=m(A,"LABEL",{for:!0});var re=k(s);w=D(re,"Invite key"),re.forEach(u),L=H(A),b=m(A,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),P=H(A),Z(T.$$.fragment,A),A.forEach(u),oe.forEach(u),S=H($),h=m($,"BUTTON",{"aria-busy":!0});var ne=k(h);p=D(ne,"Join the organization!"),ne.forEach(u),z=H($),f=m($,"HR",{}),I=m($,"BR",{}),O=H($),g=m($,"DIV",{class:!0});var j=k(g);E=m(j,"BUTTON",{});var ae=k(E);J=D(ae,"Create an org instead"),ae.forEach(u),M=H(j),R=m(j,"BUTTON",{class:!0});var le=k(R);K=D(le,"Nevermind, sign out"),le.forEach(u),j.forEach(u),$.forEach(u),this.h()},h(){y(t,"class","page-name-header"),y(s,"for","invitecode"),y(b,"type","username"),y(b,"name","invitecode"),y(b,"id","invitecode"),y(b,"placeholder","Your code (should be a mix of letters and numbers)"),y(n,"class","grid"),h.disabled=N=!a[3].valid||a[2],y(h,"aria-busy",a[2]),y(R,"class","contrast"),y(g,"class","grid"),y(e,"method","POST")},m(c,v){B(c,t,v),i(t,r),B(c,o,v),B(c,e,v),i(e,n),i(n,l),i(l,s),i(s,w),i(l,L),i(l,b),ce(b,a[0]),i(l,P),x(T,l,null),i(e,S),i(e,h),i(h,p),i(e,z),i(e,f),i(e,I),i(e,O),i(e,g),i(g,E),i(E,J),i(g,M),i(g,R),i(R,K),Y=!0,Q||(te=[V(b,"input",a[9]),ue(Ne.call(null,b,[Be])),V(h,"click",a[5]),V(E,"click",a[6]),V(R,"click",a[7]),ue(a[4].call(null,e)),V(e,"submit",ye(a[8]))],Q=!0)},p(c,v){v&1&&ce(b,c[0]);const $={};v&8192&&($.$$scope={dirty:v,ctx:c}),T.$set($),(!Y||v&12&&N!==(N=!c[3].valid||c[2]))&&(h.disabled=N),(!Y||v&4)&&y(h,"aria-busy",c[2])},i(c){Y||(G(T.$$.fragment,c),Y=!0)},o(c){W(T.$$.fragment,c),Y=!1},d(c){c&&u(t),c&&u(o),c&&u(e),ee(T),Q=!1,ke(te)}}}function Ce(a){let t,r,o;return{c(){t=d("center"),r=U("This is a mandatory field"),o=d("br")},l(e){t=m(e,"CENTER",{});var n=k(t);r=D(n,"This is a mandatory field"),n.forEach(u),o=m(e,"BR",{})},m(e,n){B(e,t,n),i(t,r),B(e,o,n)},p:_,d(e){e&&u(t),e&&u(o)}}}function He(a){let t,r;return t=new we({props:{on:"required",$$slots:{default:[Ce]},$$scope:{ctx:a}}}),{c(){X(t.$$.fragment)},l(o){Z(t.$$.fragment,o)},m(o,e){x(t,o,e),r=!0},p(o,e){const n={};e&8192&&(n.$$scope={dirty:e,ctx:o}),t.$set(n)},i(o){r||(G(t.$$.fragment,o),r=!0)},o(o){W(t.$$.fragment,o),r=!1},d(o){ee(t,o)}}}function Ie(a){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function Re(a){let t,r,o,e=a[1]&&fe(a),n={ctx:a,current:null,token:null,hasCatch:!1,pending:Ie,then:Oe,catch:ze,value:12,blocks:[,,,]};return be(pe,n),{c(){e&&e.c(),t=C(),r=se(),n.block.c()},l(l){e&&e.l(l),t=H(l),r=se(),n.block.l(l)},m(l,s){e&&e.m(l,s),B(l,t,s),B(l,r,s),n.block.m(l,n.anchor=s),n.mount=()=>r.parentNode,n.anchor=r,o=!0},p(l,[s]){a=l,a[1]?e?e.p(a,s):(e=fe(a),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null),ge(n,a,s)},i(l){o||(G(n.block),o=!0)},o(l){for(let s=0;s<3;s+=1){const w=n.blocks[s];W(w)}o=!1},d(l){e&&e.d(l),l&&u(t),l&&u(r),n.block.d(l),n.token=null,n=null}}}function Ue(a,t,r){let o,e;ie(a,pe,p=>r(10,o=p));const n=Te();ie(a,n,p=>r(3,e=p));let l,s,w=!1;async function L(p){let N=["facilitator_code","observer_code","participant_code"],z=["facilitator","observer","participant"],f=0;for(const I of N)try{const O=await q.collection("organization").getFullList(200,{filter:`${I}="${p}"`});if(Array.isArray(O)&&O.length==1){let g=O[0],E=z[f];return{org_name:g,role_name:E}}f++}finally{console.log("")}}async function b(){var p,N,z;try{r(2,w=!0);let f=await L(l);(f.role_name==""||((p=f.org_name)==null?void 0:p.id)=="")&&r(1,s="Your code seems to be invlid; try again!");const I={role:f.role_name,org:(N=f.org_name)==null?void 0:N.id},O=await q.collection("users").update(o.id,I);if(o.org!=""){const g=await q.collection("organization").getOne(o.org,{expand:"members"});console.log(g.members);let E=[...g.members,o.id];console.log(E);const J={name:f.org_name.name,members:E};console.log(J);const M=await q.collection("organization").update((z=f.org_name)==null?void 0:z.id,J);await F("/dashboard")}else r(1,s="Your code seems to be invlid; try again!"),await F("/joinorg")}catch(f){r(2,w=!1),r(1,s=f),console.log(f)}r(2,w=!1)}async function P(){F("createorg")}async function T(){await q.authStore.clear(),F("/")}he(async()=>{o.org!=""&&F("/dashboard")});function S(p){$e.call(this,a,p)}function h(){l=this.value,r(0,l)}return[l,s,w,e,n,b,P,T,S,h]}class De extends de{constructor(t){super(),me(this,t,Ue,Re,_e,{})}}function Je(a){let t,r,o;return r=new De({}),{c(){t=d("body"),X(r.$$.fragment)},l(e){t=m(e,"BODY",{});var n=k(t);Z(r.$$.fragment,n),n.forEach(u)},m(e,n){B(e,t,n),x(r,t,null),o=!0},p:_,i(e){o||(G(r.$$.fragment,e),o=!0)},o(e){W(r.$$.fragment,e),o=!1},d(e){e&&u(t),ee(r)}}}class qe extends de{constructor(t){super(),me(this,t,null,Je,_e,{})}}export{qe as default};
