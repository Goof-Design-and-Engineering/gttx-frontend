import{S as pe,i as be,s as ge,D as ve,e as ue,b as U,H as ye,g as W,d as X,h as i,L as fe,o as ke,R as $e,n as _,k as u,r as A,a as I,z as ee,l as f,m as E,u as L,c as R,A as te,p as y,G as s,W as de,B as re,M as F,X as me,Z as Ee,C as oe,N as we,q as x}from"../chunks/index.4fc2f4c3.js";import{c as he,p as M}from"../chunks/pocketbase.7918e77e.js";import{H as Te,a as Ne}from"../chunks/HintGroup.74a3b5b1.js";import{u as Be}from"../chunks/useForm.24789db4.js";import{v as Oe,r as ze}from"../chunks/validators.c512e31b.js";import{g as V}from"../chunks/navigation.7cb7a34e.js";function Ce(a){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function Ie(a){let r,o,t,e,n,d,k,B,P,g,S,w,Y,$,p,T,O,c,H,z,C,h,N,j,Z,D,K,J,Q,ne;w=new Te({props:{for:"invitecode",$$slots:{default:[Ue]},$$scope:{ctx:a}}});let m=a[1]&&_e(a);return{c(){r=u("h1"),o=A("Join an org"),t=I(),e=u("form"),n=u("div"),d=u("div"),k=u("label"),B=A("Invite key"),P=I(),g=u("input"),S=I(),ee(w.$$.fragment),Y=I(),$=u("button"),p=A("Join the organization!"),O=I(),m&&m.c(),c=I(),H=u("hr"),z=u("br"),C=I(),h=u("div"),N=u("button"),j=A("Create an org instead"),Z=I(),D=u("button"),K=A("Nevermind, sign out"),this.h()},l(l){r=f(l,"H1",{class:!0});var v=E(r);o=L(v,"Join an org"),v.forEach(i),t=R(l),e=f(l,"FORM",{method:!0});var b=E(e);n=f(b,"DIV",{class:!0});var ae=E(n);d=f(ae,"DIV",{});var q=E(d);k=f(q,"LABEL",{for:!0});var le=E(k);B=L(le,"Invite key"),le.forEach(i),P=R(q),g=f(q,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),S=R(q),te(w.$$.fragment,q),q.forEach(i),ae.forEach(i),Y=R(b),$=f(b,"BUTTON",{"aria-busy":!0});var se=E($);p=L(se,"Join the organization!"),se.forEach(i),O=R(b),m&&m.l(b),c=R(b),H=f(b,"HR",{}),z=f(b,"BR",{}),C=R(b),h=f(b,"DIV",{class:!0});var G=E(h);N=f(G,"BUTTON",{});var ie=E(N);j=L(ie,"Create an org instead"),ie.forEach(i),Z=R(G),D=f(G,"BUTTON",{class:!0});var ce=E(D);K=L(ce,"Nevermind, sign out"),ce.forEach(i),G.forEach(i),b.forEach(i),this.h()},h(){y(r,"class","page-name-header"),y(k,"for","invitecode"),y(g,"type","username"),y(g,"name","invitecode"),y(g,"id","invitecode"),y(g,"placeholder","Your code (should be a mix of letters and numbers)"),y(n,"class","grid"),$.disabled=T=!a[3].valid||a[2],y($,"aria-busy",a[2]),y(D,"class","contrast"),y(h,"class","grid"),y(e,"method","POST")},m(l,v){U(l,r,v),s(r,o),U(l,t,v),U(l,e,v),s(e,n),s(n,d),s(d,k),s(k,B),s(d,P),s(d,g),de(g,a[0]),s(d,S),re(w,d,null),s(e,Y),s(e,$),s($,p),s(e,O),m&&m.m(e,null),s(e,c),s(e,H),s(e,z),s(e,C),s(e,h),s(h,N),s(N,j),s(h,Z),s(h,D),s(D,K),J=!0,Q||(ne=[F(g,"input",a[9]),me(Oe.call(null,g,[ze])),F($,"click",a[5]),F(N,"click",a[6]),F(D,"click",a[7]),me(a[4].call(null,e)),F(e,"submit",Ee(a[8]))],Q=!0)},p(l,v){v&1&&de(g,l[0]);const b={};v&8192&&(b.$$scope={dirty:v,ctx:l}),w.$set(b),(!J||v&12&&T!==(T=!l[3].valid||l[2]))&&($.disabled=T),(!J||v&4)&&y($,"aria-busy",l[2]),l[1]?m?m.p(l,v):(m=_e(l),m.c(),m.m(e,c)):m&&(m.d(1),m=null)},i(l){J||(W(w.$$.fragment,l),J=!0)},o(l){X(w.$$.fragment,l),J=!1},d(l){l&&i(r),l&&i(t),l&&i(e),oe(w),m&&m.d(),Q=!1,we(ne)}}}function Re(a){let r,o,t;return{c(){r=u("center"),o=A("This is a mandatory field"),t=u("br")},l(e){r=f(e,"CENTER",{});var n=E(r);o=L(n,"This is a mandatory field"),n.forEach(i),t=f(e,"BR",{})},m(e,n){U(e,r,n),s(r,o),U(e,t,n)},p:_,d(e){e&&i(r),e&&i(t)}}}function Ue(a){let r,o;return r=new Ne({props:{on:"required",$$slots:{default:[Re]},$$scope:{ctx:a}}}),{c(){ee(r.$$.fragment)},l(t){te(r.$$.fragment,t)},m(t,e){re(r,t,e),o=!0},p(t,e){const n={};e&8192&&(n.$$scope={dirty:e,ctx:t}),r.$set(n)},i(t){o||(W(r.$$.fragment,t),o=!0)},o(t){X(r.$$.fragment,t),o=!1},d(t){oe(r,t)}}}function _e(a){let r,o;return{c(){r=u("center"),o=u("input"),this.h()},l(t){r=f(t,"CENTER",{});var e=E(r);o=f(e,"INPUT",{style:!0,type:!0}),e.forEach(i),this.h()},h(){x(o,"border","2px solid red"),x(o,"border-radius","5px"),x(o,"text-align","center"),y(o,"type","text"),o.value=a[1],o.readOnly=!0},m(t,e){U(t,r,e),s(r,o)},p(t,e){e&2&&o.value!==t[1]&&(o.value=t[1])},d(t){t&&i(r)}}}function He(a){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function De(a){let r,o,t={ctx:a,current:null,token:null,hasCatch:!1,pending:He,then:Ie,catch:Ce,value:12,blocks:[,,,]};return ve(he,t),{c(){r=ue(),t.block.c()},l(e){r=ue(),t.block.l(e)},m(e,n){U(e,r,n),t.block.m(e,t.anchor=n),t.mount=()=>r.parentNode,t.anchor=r,o=!0},p(e,[n]){a=e,ye(t,a,n)},i(e){o||(W(t.block),o=!0)},o(e){for(let n=0;n<3;n+=1){const d=t.blocks[n];X(d)}o=!1},d(e){e&&i(r),t.block.d(e),t.token=null,t=null}}}function Je(a,r,o){let t,e;fe(a,he,p=>o(10,t=p));const n=Be();fe(a,n,p=>o(3,e=p));let d,k,B=!1;async function P(p){let T=["facilitator_code","observer_code","participant_code"],O=["facilitator","observer","participant"],c=0;for(const H of T)try{const z=await M.collection("organization").getFullList(200,{filter:`${H}="${p}"`});if(Array.isArray(z)&&z.length==1){let C=z[0],h=O[c];return{org_name:C,role_name:h}}c++}finally{console.log("")}}async function g(){var p,T,O;o(1,k="");try{o(2,B=!0);let c=await P(d);(c.role_name==""||((p=c.org_name)==null?void 0:p.id)=="")&&o(1,k="Your code seems to be invalid; try again!");const H={role:c.role_name,org:(T=c.org_name)==null?void 0:T.id},z=await M.collection("users").update(t.id,H);if(t.org!=""){const C=await M.collection("organization").getOne(t.org,{expand:"members"});console.log(C.members);let h=[...C.members,t.id];console.log(h);const N={name:c.org_name.name,members:h};console.log(N);const j=await M.collection("organization").update((O=c.org_name)==null?void 0:O.id,N);await V("/dashboard")}else o(1,k="Your code seems to be invlid; try again!"),await V("/joinorg")}catch(c){o(2,B=!1),o(1,k=c),console.log(c)}o(2,B=!1)}async function S(){V("createorg")}async function w(){await M.authStore.clear(),V("/")}ke(async()=>{t.org!=""&&V("/dashboard")});function Y(p){$e.call(this,a,p)}function $(){d=this.value,o(0,d)}return[d,k,B,e,n,g,S,w,Y,$]}class qe extends pe{constructor(r){super(),be(this,r,Je,De,ge,{})}}function Ae(a){let r,o,t;return o=new qe({}),{c(){r=u("body"),ee(o.$$.fragment)},l(e){r=f(e,"BODY",{});var n=E(r);te(o.$$.fragment,n),n.forEach(i)},m(e,n){U(e,r,n),re(o,r,null),t=!0},p:_,i(e){t||(W(o.$$.fragment,e),t=!0)},o(e){X(o.$$.fragment,e),t=!1},d(e){e&&i(r),oe(o)}}}class Ve extends pe{constructor(r){super(),be(this,r,null,Ae,ge,{})}}export{Ve as default};
