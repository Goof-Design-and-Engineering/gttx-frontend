import{S as de,i as me,s as _e,D as be,a as O,e as ie,c as C,b as T,H as ge,g as j,d as G,h as c,L as se,o as he,k as m,r as U,l as _,m as v,u as D,G as s,v as ve,R as $e,n as p,z as X,A as Z,p as y,V as ce,B as x,M as S,W as ue,Y as ke,C as ee,N as ye}from"../chunks/index.f25a3516.js";import{c as pe,p as V}from"../chunks/pocketbase.4c010b3b.js";import{H as Ee,a as we}from"../chunks/HintGroup.aa7a84a4.js";import{u as Te,v as Ne,r as Be}from"../chunks/validators.75e44f34.js";import{g as q}from"../chunks/navigation.b6d28c6e.js";function fe(a){let t,r;return{c(){t=m("p"),r=U(a[1])},l(o){t=_(o,"P",{});var e=v(t);r=D(e,a[1]),e.forEach(c)},m(o,e){T(o,t,e),s(t,r)},p(o,e){e&2&&ve(r,o[1])},d(o){o&&c(t)}}}function ze(a){return{c:p,l:p,m:p,p,i:p,o:p,d:p}}function Oe(a){let t,r,o,e,n,l,i,H,Y,b,A,k,L,u,N,E,d,I,B,z,g,w,F,W,R,K,P,Q,te;return k=new Ee({props:{for:"invitecode",$$slots:{default:[He]},$$scope:{ctx:a}}}),{c(){t=m("h1"),r=U("Join an org"),o=O(),e=m("form"),n=m("div"),l=m("div"),i=m("label"),H=U("Invite key"),Y=O(),b=m("input"),A=O(),X(k.$$.fragment),L=O(),u=m("button"),N=U("Join the organization!"),d=O(),I=m("hr"),B=m("br"),z=O(),g=m("div"),w=m("button"),F=U("Create an org instead"),W=O(),R=m("button"),K=U("Nevermind, sign out"),this.h()},l(f){t=_(f,"H1",{class:!0});var $=v(t);r=D($,"Join an org"),$.forEach(c),o=C(f),e=_(f,"FORM",{method:!0});var h=v(e);n=_(h,"DIV",{class:!0});var oe=v(n);l=_(oe,"DIV",{});var J=v(l);i=_(J,"LABEL",{for:!0});var re=v(i);H=D(re,"Invite key"),re.forEach(c),Y=C(J),b=_(J,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0}),A=C(J),Z(k.$$.fragment,J),J.forEach(c),oe.forEach(c),L=C(h),u=_(h,"BUTTON",{});var ne=v(u);N=D(ne,"Join the organization!"),ne.forEach(c),d=C(h),I=_(h,"HR",{}),B=_(h,"BR",{}),z=C(h),g=_(h,"DIV",{class:!0});var M=v(g);w=_(M,"BUTTON",{});var ae=v(w);F=D(ae,"Create an org instead"),ae.forEach(c),W=C(M),R=_(M,"BUTTON",{class:!0});var le=v(R);K=D(le,"Nevermind, sign out"),le.forEach(c),M.forEach(c),h.forEach(c),this.h()},h(){y(t,"class","page-name-header"),y(i,"for","invitecode"),y(b,"type","username"),y(b,"name","invitecode"),y(b,"id","invitecode"),y(b,"placeholder","Your code (should be a mix of letters and numbers)"),y(n,"class","grid"),u.disabled=E=!a[2].valid,y(R,"class","contrast"),y(g,"class","grid"),y(e,"method","POST")},m(f,$){T(f,t,$),s(t,r),T(f,o,$),T(f,e,$),s(e,n),s(n,l),s(l,i),s(i,H),s(l,Y),s(l,b),ce(b,a[0]),s(l,A),x(k,l,null),s(e,L),s(e,u),s(u,N),s(e,d),s(e,I),s(e,B),s(e,z),s(e,g),s(g,w),s(w,F),s(g,W),s(g,R),s(R,K),P=!0,Q||(te=[S(b,"input",a[8]),ue(Ne.call(null,b,[Be])),S(u,"click",a[4]),S(w,"click",a[5]),S(R,"click",a[6]),ue(a[3].call(null,e)),S(e,"submit",ke(a[7]))],Q=!0)},p(f,$){$&1&&ce(b,f[0]);const h={};$&4096&&(h.$$scope={dirty:$,ctx:f}),k.$set(h),(!P||$&4&&E!==(E=!f[2].valid))&&(u.disabled=E)},i(f){P||(j(k.$$.fragment,f),P=!0)},o(f){G(k.$$.fragment,f),P=!1},d(f){f&&c(t),f&&c(o),f&&c(e),ee(k),Q=!1,ye(te)}}}function Ce(a){let t,r,o;return{c(){t=m("center"),r=U("This is a mandatory field"),o=m("br")},l(e){t=_(e,"CENTER",{});var n=v(t);r=D(n,"This is a mandatory field"),n.forEach(c),o=_(e,"BR",{})},m(e,n){T(e,t,n),s(t,r),T(e,o,n)},p,d(e){e&&c(t),e&&c(o)}}}function He(a){let t,r;return t=new we({props:{on:"required",$$slots:{default:[Ce]},$$scope:{ctx:a}}}),{c(){X(t.$$.fragment)},l(o){Z(t.$$.fragment,o)},m(o,e){x(t,o,e),r=!0},p(o,e){const n={};e&4096&&(n.$$scope={dirty:e,ctx:o}),t.$set(n)},i(o){r||(j(t.$$.fragment,o),r=!0)},o(o){G(t.$$.fragment,o),r=!1},d(o){ee(t,o)}}}function Ie(a){return{c:p,l:p,m:p,p,i:p,o:p,d:p}}function Re(a){let t,r,o,e=a[1]&&fe(a),n={ctx:a,current:null,token:null,hasCatch:!1,pending:Ie,then:Oe,catch:ze,value:11,blocks:[,,,]};return be(pe,n),{c(){e&&e.c(),t=O(),r=ie(),n.block.c()},l(l){e&&e.l(l),t=C(l),r=ie(),n.block.l(l)},m(l,i){e&&e.m(l,i),T(l,t,i),T(l,r,i),n.block.m(l,n.anchor=i),n.mount=()=>r.parentNode,n.anchor=r,o=!0},p(l,[i]){a=l,a[1]?e?e.p(a,i):(e=fe(a),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null),ge(n,a,i)},i(l){o||(j(n.block),o=!0)},o(l){for(let i=0;i<3;i+=1){const H=n.blocks[i];G(H)}o=!1},d(l){e&&e.d(l),l&&c(t),l&&c(r),n.block.d(l),n.token=null,n=null}}}function Ue(a,t,r){let o,e;se(a,pe,u=>r(9,o=u));const n=Te();se(a,n,u=>r(2,e=u));let l,i;async function H(u){let N=["facilitator_code","observer_code","participant_code"],E=["facilitator","observer","participant"],d=0;for(const I of N)try{const B=await V.collection("organization").getFullList(200,{filter:`${I}="${u}"`});if(Array.isArray(B)&&B.length==1){let z=B[0],g=E[d];return{org_name:z,role_name:g}}d++}finally{console.log("")}}async function Y(){var u,N,E;try{let d=await H(l);(d.role_name==""||((u=d.org_name)==null?void 0:u.id)=="")&&r(1,i="Your code seems to be invlid; try again!");const I={role:d.role_name,org:(N=d.org_name)==null?void 0:N.id},B=await V.collection("users").update(o.id,I);if(o.org!=""){const z=await V.collection("organization").getOne(o.org,{expand:"members"});console.log(z.members);let g=[...z.members,o.id];console.log(g);const w={name:d.org_name.name,members:g};console.log(w);const F=await V.collection("organization").update((E=d.org_name)==null?void 0:E.id,w);await q("/dashboard")}else r(1,i="Your code seems to be invlid; try again!"),await q("/joinorg")}catch(d){r(1,i=d),console.log(d)}}async function b(){q("createorg")}async function A(){await V.authStore.clear(),q("/")}he(async()=>{o.org!=""&&q("/dashboard")});function k(u){$e.call(this,a,u)}function L(){l=this.value,r(0,l)}return[l,i,e,n,Y,b,A,k,L]}class De extends de{constructor(t){super(),me(this,t,Ue,Re,_e,{})}}function Je(a){let t,r,o;return r=new De({}),{c(){t=m("body"),X(r.$$.fragment)},l(e){t=_(e,"BODY",{});var n=v(t);Z(r.$$.fragment,n),n.forEach(c)},m(e,n){T(e,t,n),x(r,t,null),o=!0},p,i(e){o||(j(r.$$.fragment,e),o=!0)},o(e){G(r.$$.fragment,e),o=!1},d(e){e&&c(t),ee(r)}}}class Ve extends de{constructor(t){super(),me(this,t,null,Je,_e,{})}}export{Ve as default};
