var S=Object.defineProperty;var Z=(t,e,o)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var c=(t,e,o)=>(Z(t,typeof e!="symbol"?e+"":e,o),o);import{Z as $,t as q,_ as z}from"./index.f25a3516.js";import{w as W}from"./index.a6262eea.js";const D=()=>/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),A="svelte-use-form-webkit-autofill",G=`
@keyframes ${A} {
    from {}
}

input:-webkit-autofill {
    animation-name: svelte-use-form-webkit-autofill;
}
`;function P(){if(document.getElementById("svelte-use-form-chrome-autofill-styles")===null){const t=document.createElement("style");t.setAttribute("id","svelte-use-form-chrome-autofill-styles"),t.setAttribute("type","text/css"),t.appendChild(document.createTextNode(G)),document.head.appendChild(t)}}function J(t,e,o){if(!D())return;function l(r){r.animationName.includes(A)&&(t.value||(e.valid=!0,o()))}t.addEventListener("animationstart",l),P()}class L{constructor(e){c(this,"validators");c(this,"errors",{});c(this,"errorMap",{});c(this,"elements",[]);c(this,"valid",!0);c(this,"_touched",!1);c(this,"initial");c(this,"formRef");c(this,"_value","");this.formRef=e.formRef,this.validators=e.validators,this.errorMap=e.errorMap,this.initial=e.value,this.elements=e.elements,this.value=e.value}get value(){return this._value}get touched(){return this._touched}set value(e){this._value=e,this.validate()}set touched(e){this._touched=e,this.elements.forEach(o=>{e?o.classList.add("touched"):o.classList.remove("touched")})}error(e){this.errors={...e,...this.errors},this.valid=!1,this.formRef()._notifyListeners()}change(e){this.value=e,this.elements.forEach(o=>o.value=e)}validate(){let e=!0;this.errors={};for(const o of this.validators){const l=o(this.value,this.formRef());if(l){e=!1;for(const r of Object.entries(l)){let[u,f]=r;const d=this.errorMap[u];d&&(f=typeof d=="function"?d(f):d),this.errors[u]=f}}}return this.valid=e,this.elements.forEach(o=>o.setCustomValidity(e?"":"Field is invalid")),e}reset({value:e}={}){const o=e??this.initial;this.elements.forEach(l=>l.value=o),this.value=o,this.touched=!1,this.formRef()._notifyListeners()}}class C{constructor(e,o){c(this,"_notifyListeners");for(const[l,r]of Object.entries(e))this._addControl(l,r.initial,r.validators,[],r.errorMap);this._notifyListeners=o}static create(e,o){return new C(e,o)}get valid(){let e=!0;return this.forEachControl(o=>{o.valid||(e=!1)}),e}get touched(){let e=!0;return this.forEachControl(o=>{o.touched||(e=!1)}),e}get values(){let e={};return this.forEachControl((o,l)=>{e[l]=o.value}),e}set touched(e){this.forEachControl(o=>{o.touched=e}),this._notifyListeners()}reset(){this.forEachControl(e=>e.reset())}_addControl(e,o="",l=[],r=[],u={}){this[e]=new L({value:o,validators:l,elements:r,errorMap:u,formRef:()=>this})}forEachControl(e){for(const[o,l]of Object.entries(this))l instanceof L&&e(l,o)}}class w extends Error{}function K(t){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement}function b(t){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement}function _(t){return t.hasAttribute("data-suf-ignore")&&t.getAttribute("data-suf-ignore")==="true"||t.getAttribute("data-suf-ignore")===!0}const I=W([]);function te(t={},e="svelte-use-form"){const o=[];let l=[],r=C.create(t,h),u;f.subscribe=O,f.set=j,$(e,f);function f(i){return d(i),I.update(n=>[...n,{node:i,form:r,notifyListeners:h}]),{update:()=>{},destroy:()=>{H(),u.disconnect()}}}function d(i){const n=[...p(i,"input")],s=[...p(i,"textarea")],a=[...p(i,"select")],m=[...n,...s];M(m),T(a),N([...m,...a]),F(i),h()}function M(i){for(const n of i){const s=n.name;let a=r[s];if(a)a.elements.push(n),n.type==="radio"&&n instanceof HTMLInputElement&&n.checked&&(a.initial=n.value);else{const m=Q(n);r._addControl(s,m,[],[n],{}),a=r[s]}switch(n.type){case"checkbox":case"radio":v(n,"click",E);break;default:k(n,a),R(n,a),v(n,"blur",E)}v(n,"input",y)}}function T(i){for(const n of i){const s=n.name,a=r[s];if(a)a.elements.push(n),k(n,a);else{const m=n.value;r._addControl(s,m,[],[n],{})}v(n,"input",y),v(n,"input",E),v(n,"blur",E)}}function F(i){u=new MutationObserver(x),u.observe(i,{childList:!0,subtree:!0})}function x(i){for(const n of i)if(n.type==="childList"){for(const s of n.addedNodes){if(!(b(s)&&!_(s)))continue;const a=t[s.name];!r[s.name]&&a&&r._addControl(s.name,a.initial,a.validators,[],a.errorMap),K(s)?M([s]):s instanceof HTMLSelectElement&&T([s])}for(const s of n.removedNodes){if(!(s instanceof HTMLElement))continue;(b(s)?[s]:U(s)).forEach(m=>{delete r[m.name],l=l.filter(B=>B.node!==m)})}}h()}function v(i,n,s){i.addEventListener(n,s),l.push({node:i,event:n,listener:s})}function H(){for(const{node:i,event:n,listener:s}of l)i.removeEventListener(n,s)}function R(i,n){J(i,n,h);function s(){return i.value!==n.initial?(E({target:i}),!0):!1}s()||setTimeout(()=>s(),100)}function y({target:i}){if(b(i)){const n=i.name,s=r[n];if(!s)throw new w;let a;i.type==="checkbox"&&i instanceof HTMLInputElement?a=i.checked?"checked":"":a=i.value,s.value=a,h()}}function E({target:i}){if(b(i)){const n=r[i.name];if(!n)throw new w;n.touched||y({target:i}),n.touched=!0,i.classList.add("touched"),h()}}function N(i){for(const n of Object.keys(t)){let s=!1;for(const a of i)n===a.name&&(s=!0);s||delete r[n]}}function k(i,n){n.initial&&(i.value=n.initial)}function h(){for(const i of o)i(r)}function O(i){return o.push(i),i(r),{unsubscribe:()=>V(i)}}function V(i){const n=o.indexOf(i);o.splice(n,1)}function j(i){r=i,h()}return f}function Q(t){let e;return t.type==="radio"&&t instanceof HTMLInputElement?e=t.checked?t.value:"":t.type==="checkbox"&&t instanceof HTMLInputElement?e=t.checked?"checked":"":e=t.value,e}function p(t,e){return Array.from(t.getElementsByTagName(e)).filter(o=>!_(o))}function U(t){const e=p(t,"input"),o=p(t,"textarea"),l=p(t,"select");return[...e,...o,...l]}function ne(t,e){o();async function o(){const l=t.form;if(!l)throw new g("HTML element doesn't have an ancestral form");await q();const r=z(I).find(f=>f.node===l);if(!r)throw new g("HTML form doesn't have a svelte-use-form binded. (use:form)");const u=r.form[t.name];if(!(u instanceof L))throw new g(`Form Control [${t.name}] doesn't exist.`);u.validators.push(...e),u.validate(),r.notifyListeners()}}class g extends Error{}function ie(t){return t.trim()?null:{required:"Required"}}function oe(t){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(t)?null:{email:{}}}export{oe as e,ie as r,te as u,ne as v};
