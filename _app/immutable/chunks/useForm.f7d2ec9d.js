var j=Object.defineProperty;var B=(i,e,s)=>e in i?j(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var u=(i,e,s)=>(B(i,typeof e!="symbol"?e+"":e,s),s);import{Z as S}from"./index.d8729f0b.js";import{w as W}from"./index.40a0b426.js";const D=()=>/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),A="svelte-use-form-webkit-autofill",G=`
@keyframes ${A} {
    from {}
}

input:-webkit-autofill {
    animation-name: svelte-use-form-webkit-autofill;
}
`;function P(){if(document.getElementById("svelte-use-form-chrome-autofill-styles")===null){const i=document.createElement("style");i.setAttribute("id","svelte-use-form-chrome-autofill-styles"),i.setAttribute("type","text/css"),i.appendChild(document.createTextNode(G)),document.head.appendChild(i)}}function Z(i,e,s){if(!D())return;function l(a){a.animationName.includes(A)&&(i.value||(e.valid=!0,s()))}i.addEventListener("animationstart",l),P()}class k{constructor(e){u(this,"validators");u(this,"errors",{});u(this,"errorMap",{});u(this,"elements",[]);u(this,"valid",!0);u(this,"_touched",!1);u(this,"initial");u(this,"formRef");u(this,"_value","");this.formRef=e.formRef,this.validators=e.validators,this.errorMap=e.errorMap,this.initial=e.value,this.elements=e.elements,this.value=e.value}get value(){return this._value}get touched(){return this._touched}set value(e){this._value=e,this.validate()}set touched(e){this._touched=e,this.elements.forEach(s=>{e?s.classList.add("touched"):s.classList.remove("touched")})}error(e){this.errors={...e,...this.errors},this.valid=!1,this.formRef()._notifyListeners()}change(e){this.value=e,this.elements.forEach(s=>s.value=e)}validate(){let e=!0;this.errors={};for(const s of this.validators){const l=s(this.value,this.formRef());if(l){e=!1;for(const a of Object.entries(l)){let[c,h]=a;const d=this.errorMap[c];d&&(h=typeof d=="function"?d(h):d),this.errors[c]=h}}}return this.valid=e,this.elements.forEach(s=>s.setCustomValidity(e?"":"Field is invalid")),e}reset({value:e}={}){const s=e??this.initial;this.elements.forEach(l=>l.value=s),this.value=s,this.touched=!1,this.formRef()._notifyListeners()}}class y{constructor(e,s){u(this,"_notifyListeners");for(const[l,a]of Object.entries(e))this._addControl(l,a.initial,a.validators,[],a.errorMap);this._notifyListeners=s}static create(e,s){return new y(e,s)}get valid(){let e=!0;return this.forEachControl(s=>{s.valid||(e=!1)}),e}get touched(){let e=!0;return this.forEachControl(s=>{s.touched||(e=!1)}),e}get values(){let e={};return this.forEachControl((s,l)=>{e[l]=s.value}),e}set touched(e){this.forEachControl(s=>{s.touched=e}),this._notifyListeners()}reset(){this.forEachControl(e=>e.reset())}_addControl(e,s="",l=[],a=[],c={}){this[e]=new k({value:s,validators:l,elements:a,errorMap:c,formRef:()=>this})}forEachControl(e){for(const[s,l]of Object.entries(this))l instanceof k&&e(l,s)}}class T extends Error{}function $(i){return i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement}function b(i){return i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement}function I(i){return i.hasAttribute("data-suf-ignore")&&i.getAttribute("data-suf-ignore")==="true"||i.getAttribute("data-suf-ignore")===!0}const q=W([]);function X(i={},e="svelte-use-form"){const s=[];let l=[],a=y.create(i,m),c;h.subscribe=N,h.set=O,S(e,h);function h(n){return d(n),q.update(t=>[...t,{node:n,form:a,notifyListeners:m}]),{update:()=>{},destroy:()=>{w(),c.disconnect()}}}function d(n){const t=[...p(n,"input")],o=[...p(n,"textarea")],r=[...p(n,"select")],f=[...t,...o];L(f),C(r),H([...f,...r]),_(n),m()}function L(n){for(const t of n){const o=t.name;let r=a[o];if(r)r.elements.push(t),t.type==="radio"&&t instanceof HTMLInputElement&&t.checked&&(r.initial=t.value);else{const f=z(t);a._addControl(o,f,[],[t],{}),r=a[o]}switch(t.type){case"checkbox":case"radio":v(t,"click",E);break;default:M(t,r),x(t,r),v(t,"blur",E)}v(t,"input",g)}}function C(n){for(const t of n){const o=t.name,r=a[o];if(r)r.elements.push(t),M(t,r);else{const f=t.value;a._addControl(o,f,[],[t],{})}v(t,"input",g),v(t,"input",E),v(t,"blur",E)}}function _(n){c=new MutationObserver(F),c.observe(n,{childList:!0,subtree:!0})}function F(n){for(const t of n)if(t.type==="childList"){for(const o of t.addedNodes){if(!(b(o)&&!I(o)))continue;const r=i[o.name];!a[o.name]&&r&&a._addControl(o.name,r.initial,r.validators,[],r.errorMap),$(o)?L([o]):o instanceof HTMLSelectElement&&C([o])}for(const o of t.removedNodes){if(!(o instanceof HTMLElement))continue;(b(o)?[o]:J(o)).forEach(f=>{delete a[f.name],l=l.filter(V=>V.node!==f)})}}m()}function v(n,t,o){n.addEventListener(t,o),l.push({node:n,event:t,listener:o})}function w(){for(const{node:n,event:t,listener:o}of l)n.removeEventListener(t,o)}function x(n,t){Z(n,t,m);function o(){return n.value!==t.initial?(E({target:n}),!0):!1}o()||setTimeout(()=>o(),100)}function g({target:n}){if(b(n)){const t=n.name,o=a[t];if(!o)throw new T;let r;n.type==="checkbox"&&n instanceof HTMLInputElement?r=n.checked?"checked":"":r=n.value,o.value=r,m()}}function E({target:n}){if(b(n)){const t=a[n.name];if(!t)throw new T;t.touched||g({target:n}),t.touched=!0,n.classList.add("touched"),m()}}function H(n){for(const t of Object.keys(i)){let o=!1;for(const r of n)t===r.name&&(o=!0);o||delete a[t]}}function M(n,t){t.initial&&(n.value=t.initial)}function m(){for(const n of s)n(a)}function N(n){return s.push(n),n(a),{unsubscribe:()=>R(n)}}function R(n){const t=s.indexOf(n);s.splice(t,1)}function O(n){a=n,m()}return h}function z(i){let e;return i.type==="radio"&&i instanceof HTMLInputElement?e=i.checked?i.value:"":i.type==="checkbox"&&i instanceof HTMLInputElement?e=i.checked?"checked":"":e=i.value,e}function p(i,e){return Array.from(i.getElementsByTagName(e)).filter(s=>!I(s))}function J(i){const e=p(i,"input"),s=p(i,"textarea"),l=p(i,"select");return[...e,...s,...l]}export{k as F,q as f,X as u};
